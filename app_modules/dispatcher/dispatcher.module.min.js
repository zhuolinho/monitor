module.exports=function(){function n(n){return n.op?l[n.ns][n.op](n).fail(function(e){return console.log("DISPATCHER:  routing failed: ",n.op,e),r.reject({ns:n.ns,pl:null,er:{ec:null,em:e+" for message: "+n}})}):(console.log("no operation specified"),r.reject({ns:"",pl:null,er:{ec:null,em:"DISPATCHER: no such operations"}}))}var e=require("fs"),r=require("q"),o=require("path"),l={};console.log("\nDISPATCHER: UP ...");var i=o.resolve(__dirname,".."),t=e.readdirSync;t(i).forEach(function(n){var e="dispatcher";if(!n.split(".")[1]&&n!=e){var r=i+"/"+n+"/"+n+".module";try{l[n]=require(r)}catch(o){throw o}finally{}}});var u=[];for(var c in l)if(l.hasOwnProperty(c)){var a=l[c];if(a.init instanceof Function){var s={op:"init",ns:c,pl:{}};p=n(s),u.push(p)}}return r.all(u).then(function(e){return console.log("DISPATCHER: DONE! "),r({pl:{fn:n},er:null})}).fail(function(n){return console.log("DISPATCHER:  FAIL!  "+n),r({pl:null,er:{ec:null,em:n}})})};